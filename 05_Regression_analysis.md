#  회귀분석 with R

## 1. 회귀분석 

###  (0) 기본 전체 및 이론 정리

- **독립** 변수는 수치형이고 연속형 자료여야 한다.
- **종속** 변수는 범주형 혹은 수치형 자료여야 한다.

- 회귀식의 F-statistic은 y = 1과 y = 회귀식의 분산 값을 비교하여 검정한 것이다.

``````R
#모델평가 (분산분석)
summary(m)
full<-lm(dist~speed,data=cars) #집단A
reduced<-lm(dist~1,data=cars) #집단B
anova(reduced,full)
``````



### (1) 회귀분석의 기본가정 (BLUE)

1. 선형성  - 종속변수 독립변수 간 선형관계
2. 잔차의 정규성 - 오차항의 기대값 = 0
3. 잔차의 등분산성 - 독립변수와 오차항 간 독립성
4. 잔차의 독립성 - 오차항 간 독립성
5. 다중공선성이 없어야 함 - 독립변수 간 독립성(독립변수 간에 인과관계가 없어야 한다.)

![image](https://user-images.githubusercontent.com/57510026/70873777-8b6dd880-1ff2-11ea-8422-099ec452f21c.png)

``````R
m <- lm(dist~speed, data=cars)
summary(m)

#그림 1. 잔차의 분포, 빨간 선은 잔차의 평균 > 잔차의 평균이 0이다.등분산성도 약간 체크 가능하다.
#그림 2. Q-Q plot > 잔차의 정규성 검증
#그림 4. 잔차에 따른 Leverage(영향력)
## cook's distance : 평균에 가까운 잔차는 0에 나오고 오차가 큰 잔차는 큰 값이 나온다.(즉 잔차의 영향력에 대한 척도)
par(mfrow=c(2,2), mar=c(3,3,3,3))
plot(m)
``````



### (2) 선형성

- 선형성을 만족하기 위해서는 다음을 만족해야 한다.

  1)  Superpostion (additivity) 

  - f(ax<sub>1</sub>) = af*(x<sub>1</sub>)

  2)  Homogeneity

  - f(a<sub>1</sub>x<sub>1</sub> + a<sub>2</sub>x<sub>2</sub>) = a<sub>1</sub>\*f(x<sub>1</sub>) + a<sub>2</sub>*f(x<sub>2</sub>)
  
  

### (3) 잔차의 정규성

- Normal Probability Plot (**Q-Q plot**)으로 검토한다. Q-Q plot이 45도의 기울기를 가진 직선에 가까우면 가까울수록 오차항이 정규분포를 따른다고 볼 수 있다. 
  
- 관측치의 누적확률과 예상치의 누적확률을 각각 x축, y축으로 점을 찍어 그림으로 만든 것이다. 만일 분포가 유사하다면 점점 y = x로 점들이 수렴해 갈 것이다.
  
- **shapiro.test()** : 단일 정규성 검정(shaprio-wilk검정방법) 혹은

  - 정규분포를 따르면 w값이 1에 가까워진다.

- **qqnormal()**를 이용할 수 있다.

  

### (4) 잔차의 등분산성

- 잔차의 이분산성이 회귀식에 미치는 영향
  1. 회귀추정으로 산출된 표준오차의 신뢰성이 낮다.
  2. 만일 표준오차가 과소계상될 경우 추정 회귀계수의 T통계량이 과대 평가 되어 귀무가설을 기각하는 오류 발생 (**1종 오류 발생**)
  3. F검정의 신뢰성이 낮아진다.
  
  

### (5) 잔차의 독립성 (계열 상관성이 없다.)

- **계열 상관성**은 **자기상관(autocorrelation)**이라고도 하는데, 오차항들끼리 상관성이 존재하는 현상을 의미하며 횡단면 자료(Cross-sectional)가 아닌 시계열 자료(time-sesries)에서 주로 나타난다.

- 잔차의 독립성이 만족한다면  E[ε<sub>i</sub> ε<sub>j</sub>] =0, (i ≠j)이 성립한다. 즉 i시점의 잔차와 j시점의 잔차의 공분산 값이 0을 가진다.

- 계열 상관성의 부작용

  1. 오차항 간의 연관성으로 표준오차의 신뢰도 낮아진다. 즉, 추정 기울기 계수의 유의성 저하된다.
  2. MSE(Mean Squared Error)도 과소평가되므로, F 검정의 신뢰도 낮아진다.

- **더빈-왓슨(Durbin-Watson)** 값으로 잔차 간 독립성을 검증할 수 있다. 이때 

  독립적인 경우, 해당 값은 2가 된다. (양의 상관관계 = 0, 음의 상관관계 = 4)

``````R
install.packages("lmtest")
library(lmtest)

#더빈 왓슨 d=2(p=0:상관 관계 없음), 보통 d=1~3 정상판단
dwtest(m)
``````



### (6) 다중 공선성의 확인

- 독립변수간 높은 상관계수
  - 상관계수가 0.7 이상이면 다중 공선성을 의심한다.

- **분산팽창요인**(VIF : Variance Inflation Factors)은 다중 공선성이 추정 기울기 계수의 표준오차를 얼마나 증가시겼는지를 측정하는 지표이다.
  - 결정 계수(R<sup>2</sup>)가 커질수록 VIF의 계수값도 커진다. 
  - 전혀 관계가 없는 경우 결정 계는 VIF≒1(1에 가까워진다.)
  - 5<VIF<10이면 다중공선성 의심하고 VIF>10이면 다중공선성 심각한 것으로 판단한다.



### (7) 통계분석기법의 선택 

![selection](https://user-images.githubusercontent.com/57510026/70955407-1fec3f80-20b4-11ea-88a7-156c70262d36.jpg)

